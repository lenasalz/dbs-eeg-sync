============================= test session starts ==============================
platform darwin -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /Users/lenasalzmann/dev/dbs-eeg-sync/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/lenasalzmann/dev/dbs-eeg-sync
configfile: pyproject.toml
plugins: cov-7.0.0
collecting ... collected 51 items

tests/test_cli.py::TestCLI::test_build_arg_parser PASSED                 [  1%]
tests/test_cli.py::TestCLI::test_load_config_file_json PASSED            [  3%]
tests/test_cli.py::TestCLI::test_load_config_file_not_found PASSED       [  5%]
tests/test_cli.py::TestCLI::test_load_config_file_yaml PASSED            [  7%]
tests/test_cli.py::TestCLI::test_merge_config PASSED                     [  9%]
tests/test_cli.py::TestCLI::test_parse_time_range_invalid PASSED         [ 11%]
tests/test_cli.py::TestCLI::test_parse_time_range_none PASSED            [ 13%]
tests/test_cli.py::TestCLI::test_parse_time_range_valid PASSED           [ 15%]
tests/test_cli.py::TestCLIIntegration::test_cli_help FAILED              [ 17%]
tests/test_core.py::TestCore::test_sync_run_invalid_dbs_file PASSED      [ 19%]
tests/test_core.py::TestCore::test_sync_run_invalid_eeg_file PASSED      [ 21%]
tests/test_core.py::TestCore::test_sync_run_invalid_time_range PASSED    [ 23%]
tests/test_core.py::TestCore::test_sync_run_no_auto_crop PASSED          [ 25%]
tests/test_core.py::TestCore::test_sync_run_result_structure PASSED      [ 27%]
tests/test_core.py::TestCore::test_sync_run_smoke PASSED                 [ 29%]
tests/test_core.py::TestCore::test_sync_run_with_time_range PASSED       [ 31%]
tests/test_core.py::TestCoreUtilities::test_ensure_matplotlib_headless PASSED [ 33%]
tests/test_core.py::TestCoreUtilities::test_ensure_output_dir PASSED     [ 35%]
tests/test_core.py::TestCoreUtilities::test_ensure_output_dir_existing PASSED [ 37%]
tests/test_core.py::TestCoreUtilities::test_result_to_dict PASSED        [ 39%]
tests/test_core.py::TestCoreUtilities::test_save_run_metadata PASSED     [ 41%]
tests/test_data_loader.py::TestDataLoader::test_dbs_artifact_settings_custom PASSED [ 43%]
tests/test_data_loader.py::TestDataLoader::test_dbs_artifact_settings_defaults PASSED [ 45%]
tests/test_data_loader.py::TestDataLoader::test_load_eeg_data_file_not_found PASSED [ 47%]
tests/test_data_loader.py::TestDataLoader::test_load_eeg_data_set FAILED [ 49%]
tests/test_data_loader.py::TestDataLoader::test_load_eeg_data_unsupported_format FAILED [ 50%]
tests/test_data_loader.py::TestDataLoader::test_open_json_file PASSED    [ 52%]
tests/test_data_loader.py::TestDataLoader::test_read_lfp_data PASSED     [ 54%]
tests/test_data_loader.py::TestDataLoader::test_read_time_domain_data PASSED [ 56%]
tests/test_data_loader.py::TestDataLoader::test_select_recording_default_index PASSED [ 58%]
tests/test_data_loader.py::TestDataLoader::test_select_recording_explicit_index PASSED [ 60%]
tests/test_data_loader.py::TestDataLoader::test_select_recording_invalid_index PASSED [ 62%]
tests/test_data_loader.py::TestDataLoader::test_select_recording_no_blocks PASSED [ 64%]
tests/test_power_calculator.py::TestPowerCalculator::test_compute_samplewise_eeg_power_basic PASSED [ 66%]
tests/test_power_calculator.py::TestPowerCalculator::test_compute_samplewise_eeg_power_different_bands PASSED [ 68%]
tests/test_power_calculator.py::TestPowerCalculator::test_compute_samplewise_eeg_power_invalid_channel PASSED [ 70%]
tests/test_power_calculator.py::TestPowerCalculator::test_compute_samplewise_eeg_power_multichannel PASSED [ 72%]
tests/test_power_calculator.py::TestPowerCalculator::test_compute_samplewise_eeg_power_with_smoothing PASSED [ 74%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_dbs_sync_artifact_basic PASSED [ 76%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_dbs_sync_artifact_no_peaks PASSED [ 78%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_eeg_sync_artifact_basic PASSED [ 80%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_eeg_sync_artifact_custom_channels PASSED [ 82%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_eeg_sync_artifact_no_valid_channels PASSED [ 84%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_eeg_sync_artifact_nyquist_clamping PASSED [ 86%]
tests/test_sync_artifact_finder.py::TestSyncArtifactFinder::test_detect_eeg_sync_artifact_with_time_range PASSED [ 88%]
tests/test_synchronizer.py::TestSynchronizer::test_cut_data_at_sync_basic PASSED [ 90%]
tests/test_synchronizer.py::TestSynchronizer::test_cut_data_at_sync_invalid_index PASSED [ 92%]
tests/test_synchronizer.py::TestSynchronizer::test_cut_data_at_sync_zero_index PASSED [ 94%]
tests/test_synchronizer.py::TestSynchronizer::test_synchronize_data_no_resample PASSED [ 96%]
tests/test_synchronizer.py::TestSynchronizer::test_synchronize_data_with_resample PASSED [ 98%]
tests/test_synchronizer.py::TestSynchronizer::test_synchronize_data_with_save_dir PASSED [100%]

=================================== FAILURES ===================================
_______________________ TestCLIIntegration.test_cli_help _______________________
tests/test_cli.py:117: in test_cli_help
    self.assertIn("dbs-eeg-sync", help_text.lower())
E   AssertionError: 'dbs-eeg-sync' not found in 'usage: pytest [-h] [--sub-id sub_id] [--block block] [--eeg-file eeg_file]\n              [--dbs-file dbs_file] [--time-range time_range]\n              [--output-dir output_dir] [--plots] [--headless] [--force]\n              [--verbose] [--config config] [--manifest manifest] [--test]\n              [--gui] [--no-crop]\n\nsynchronize eeg with dbs lfp recordings via stimulation artifact (non-\ninteractive cli).\n\noptions:\n  -h, --help            show this help message and exit\n  --sub-id sub_id       subject id\n  --block block         block/session label\n  --eeg-file eeg_file   path to eeg file (e.g., .set)\n  --dbs-file dbs_file   path to dbs json file\n  --time-range time_range\n                        start,end (seconds); e.g. 120,200\n  --output-dir output_dir\n                        root output directory\n  --plots               save plots (and show unless --headless)\n  --headless            do not open any gui windows; use non-interactive\n                        matplotlib backend\n  --force               overwrite outputs if they exist (reserved)\n  --verbose             verbose logs\n  --config config       path to json or yaml config file\n  --manifest manifest   csv with columns:\n                        sub_id,block,eeg_file,dbs_file,start_sec,end_sec\n  --test                use bundled example data under ./data\n  --gui                 enable manual gui selection for synchronization\n                        (requires display; default off).\n  --no-crop             disable automatic trimming to a common window.\n'
____________________ TestDataLoader.test_load_eeg_data_set _____________________
tests/test_data_loader.py:21: in test_load_eeg_data_set
    result = load_eeg_data(file_path)
             ^^^^^^^^^^^^^^^^^^^^^^^^
dbs_eeg_sync/data_loader.py:30: in load_eeg_data
    raise FileNotFoundError(f"File not found: {file_path}")
E   FileNotFoundError: File not found: /Users/lenasalzmann/dev/dbs-eeg-sync/test.set
_____________ TestDataLoader.test_load_eeg_data_unsupported_format _____________
tests/test_data_loader.py:32: in test_load_eeg_data_unsupported_format
    load_eeg_data("test.unsupported")
dbs_eeg_sync/data_loader.py:30: in load_eeg_data
    raise FileNotFoundError(f"File not found: {file_path}")
E   FileNotFoundError: File not found: /Users/lenasalzmann/dev/dbs-eeg-sync/test.unsupported
=========================== short test summary info ============================
FAILED tests/test_cli.py::TestCLIIntegration::test_cli_help - AssertionError:...
FAILED tests/test_data_loader.py::TestDataLoader::test_load_eeg_data_set - Fi...
FAILED tests/test_data_loader.py::TestDataLoader::test_load_eeg_data_unsupported_format
======================== 3 failed, 48 passed in 46.01s =========================
